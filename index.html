<!doctype html>
<html lang="nl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Voorlees-site — De Zwamzakken</title>
  <style>
    :root{--bg:#f7fbf7;--card:#ffffff;--accent:#2a9d8f;--accent-2:#264653;--muted:#7a7a7a}
    html,body{height:100%;margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial}
    body{background:linear-gradient(180deg,#eaf6f2,white);display:flex;align-items:center;justify-content:center;padding:20px}
    .card{width:980px;max-width:100%;background:var(--card);border-radius:18px;box-shadow:0 8px 30px rgba(30,30,30,.08);padding:18px;text-align:center}
    h1{margin:0;font-size:26px;color:var(--accent-2)}
    .controls{display:flex;gap:12px;align-items:center;justify-content:center;margin-top:18px}
    button{background:var(--accent);border:none;color:white;padding:20px 26px;border-radius:20px;font-size:26px;box-shadow:0 6px 18px rgba(42,157,143,.18)}
    button.secondary{background:#eee;color:var(--accent-2);box-shadow:none}
    select,input[type=range]{padding:8px;border-radius:8px;border:1px solid #ddd}
    main{margin-top:20px}
    .story{line-height:1.6;font-size:18px;color:#222;max-height:55vh;overflow:auto;padding:12px;border-radius:10px;background:linear-gradient(180deg,#fff,#fbfffb);text-align:left}
    .sentence{padding:2px 4px;border-radius:6px}
    .active{background:rgba(42,157,143,.12);}
    .meta{margin-top:10px;color:var(--muted);font-size:14px}
    footer{margin-top:14px;display:flex;justify-content:space-between;align-items:center;font-size:13px;color:#666}
  </style>
</head>
<body>
  <div class="card" role="application">
    <header>
      <h1>De Zwamzakken — voorleesmodus</h1>
    </header>

    <div class="controls">
      <button id="playPause" class="big">▶︎</button>
      <button id="stop" class="secondary">Stop</button>
      <select id="voiceSelect" aria-label="Kies stem"></select>
      <label for="rate">Snelheid</label>
      <input id="rate" type="range" min="0.6" max="1.6" step="0.1" value="1">
      <label for="volume">Volume</label>
      <input id="volume" type="range" min="0" max="1" step="0.05" value="1">
    </div>

    <main>
      <div id="story" class="story" tabindex="0" aria-live="polite"></div>
    </main>

    <footer>
      <div>Gebruik de playknop om het verhaal te starten.</div>
      <div>Gemaakt voor kleuters — eenvoudige bediening</div>
    </footer>
  </div>

  <script>
    const rawText = `In het diepe, donkergroene bos wonen 3 vrolijke champignons: Charley, Oekie en Chaya. Ze noemen zichzelf de zwamzakken. ... (verhaal ingekort voor leesbaarheid)`;

    function splitSentences(text){
      const paras = text.split(/\n{2,}/).map(p=>p.trim()).filter(Boolean);
      const sentences = [];
      paras.forEach(p=>{
        const parts = p.match(/[^.!?\n]+[.!?]{0,1}/g) || [p];
        parts.forEach(s=>{const t=s.trim(); if(t) sentences.push(t)});
      });
      return sentences;
    }

    const sentences = splitSentences(rawText);
    const storyEl = document.getElementById('story');
    sentences.forEach((s,i)=>{
      const span = document.createElement('div');
      span.className = 'sentence';
      span.id = 's'+i;
      span.textContent = s;
      span.addEventListener('click', ()=>{goToSentence(i);});
      storyEl.appendChild(span);
    });

    let synth = window.speechSynthesis;
    let voices = [];
    let currentIndex = 0;
    let playing = false;
    let utter = null;

    const voiceSelect = document.getElementById('voiceSelect');
    const rateInput = document.getElementById('rate');
    const volumeInput = document.getElementById('volume');
    const playBtn = document.getElementById('playPause');
    const stopBtn = document.getElementById('stop');

    function populateVoices(){
      voices = synth.getVoices().filter(v=>v.lang.startsWith('nl') || v.lang.startsWith('en'));
      voiceSelect.innerHTML = '';
      voices.forEach((v,i)=>{
        const o = document.createElement('option');
        o.value = i;
        o.textContent = v.name + ' — ' + v.lang + (v.default? ' (standaard)':'');
        voiceSelect.appendChild(o);
      });
      // probeer automatisch een kindvriendelijke stem te selecteren
      const kinderStem = voices.find(v=>/child|kinder|kids|young|junior/i.test(v.name));
      if(kinderStem){
        voiceSelect.value = voices.indexOf(kinderStem);
      }
    }

    populateVoices();
    if (speechSynthesis.onvoiceschanged !== undefined) {
      speechSynthesis.onvoiceschanged = populateVoices;
    }

    function highlight(i){
      document.querySelectorAll('.sentence').forEach(el=>el.classList.remove('active'));
      const el = document.getElementById('s'+i);
      if(el){ el.classList.add('active'); el.scrollIntoView({behavior:'smooth',block:'center'}); }
    }

    function createUtter(text){
      const u = new SpeechSynthesisUtterance(text);
      const v = voices[voiceSelect.value];
      if(v) u.voice = v;
      u.rate = parseFloat(rateInput.value);
      u.volume = parseFloat(volumeInput.value);
      u.onend = onUtterEnd;
      return u;
    }

    function speakFrom(idx){
      if(idx < 0) idx = 0;
      if(idx >= sentences.length){ stop(); return; }
      currentIndex = idx;
      highlight(currentIndex);
      utter = createUtter(sentences[currentIndex]);
      playing = true;
      updatePlayButton();
      synth.speak(utter);
    }

    function onUtterEnd(){
      currentIndex++;
      if(currentIndex < sentences.length && playing){
        speakFrom(currentIndex);
      } else {
        playing = false;
        updatePlayButton();
      }
    }

    function togglePlayPause(){
      if(playing){
        synth.cancel();
        playing = false;
        updatePlayButton();
      } else {
        speakFrom(currentIndex);
      }
    }

    function stop(){
      synth.cancel();
      playing = false;
      currentIndex = 0;
      highlight(currentIndex);
      updatePlayButton();
    }

    function goToSentence(i){
      synth.cancel();
      currentIndex = i;
      if(playing) speakFrom(currentIndex); else highlight(currentIndex);
    }

    function updatePlayButton(){
      playBtn.textContent = playing ? '⏸︎' : '▶︎';
    }

    playBtn.addEventListener('click', ()=>{
      if(!playing) speakFrom(currentIndex);
      else togglePlayPause();
    });

    stopBtn.addEventListener('click', stop);

    voiceSelect.addEventListener('change', ()=>{ if(playing){ synth.cancel(); speakFrom(currentIndex); } });
    rateInput.addEventListener('change', ()=>{ if(playing){ synth.cancel(); speakFrom(currentIndex); } });
    volumeInput.addEventListener('change', ()=>{ if(playing){ synth.cancel(); speakFrom(currentIndex); } });

    window.addEventListener('keydown', (e)=>{
      if(e.code === 'Space'){ e.preventDefault(); togglePlayPause(); }
    });

    highlight(0);
  </script>
</body>
</html>

