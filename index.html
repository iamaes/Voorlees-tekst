<!doctype html>
<html lang="nl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Voorlees-site — De Zwamzakken</title>
  <style>
    :root{--bg:#f7fbf7;--card:#ffffff;--accent:#2a9d8f;--accent-2:#264653;--muted:#7a7a7a}
    html,body{height:100%;margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial}
    body{background:linear-gradient(180deg,#eaf6f2,white);display:flex;align-items:center;justify-content:center;padding:20px}
    .card{width:980px;max-width:100%;background:var(--card);border-radius:18px;box-shadow:0 8px 30px rgba(30,30,30,.08);padding:18px}
    header{display:flex;align-items:center;gap:12px}
    h1{margin:0;font-size:20px;color:var(--accent-2)}
    .controls{display:flex;gap:12px;align-items:center;margin-top:12px}
    button{background:var(--accent);border:none;color:white;padding:12px 14px;border-radius:12px;font-size:16px;box-shadow:0 6px 18px rgba(42,157,143,.18)}
    button.secondary{background:#eee;color:var(--accent-2);box-shadow:none}
    button.big{padding:22px 26px;font-size:28px;border-radius:20px}
    .small{padding:8px 10px;font-size:14px}
    .toolbar{display:flex;gap:10px;align-items:center;margin-left:auto}
    select,input[type=range]{padding:8px;border-radius:8px;border:1px solid #ddd}
    main{margin-top:14px}
    .story{line-height:1.9;font-size:18px;color:#222;max-height:48vh;overflow:auto;padding:12px;border-radius:10px;background:linear-gradient(180deg,#fff,#fbfffb)}
    .sentence{padding:4px 4px 10px;border-radius:6px}
    .active{background:rgba(42,157,143,.12);}
    .meta{margin-top:10px;color:var(--muted);font-size:14px}
    .big-buttons{display:flex;gap:8px}
    @media (max-width:520px){button{padding:10px;font-size:15px} .controls{flex-wrap:wrap}}
  </style>
</head>
<body>
  <div class="card" role="application">
    <header>
      <div>
        <h1>De Zwamzakken — voorleesmodus</h1>
      </div>
      <div class="toolbar">
        <label for="voiceSelect" class="sr-only">Stem</label>
        <select id="voiceSelect" aria-label="Kies stem"></select>
        <label for="rate">Snelheid</label>
        <input id="rate" type="range" min="0.6" max="1.6" step="0.1" value="0.8">
      </div>
    </header>

    <div class="controls">
      <div class="big-buttons">
        <button id="playPause" class="big">▶︎</button>
      </div>
      <button id="stop" class="secondary small">Stop</button>
    </div>

    <main>
      <div id="story" class="story" tabindex="0" aria-live="polite"></div>
    </main>
  </div>

  <audio id="boslied" src="zwamzakken.mp3"></audio>

<script>
  const rawText = `
In het diepe, donkergroene bos wonen drie vrolijke champignons: Charley, Oekie en Chaya. Ze noemen zichzelf de zwamzakken.

Iedere ochtend oefenen ze samen muziek.

Oekie tokkelt pling-plong op haar gitaar,

Charley trommelt ratatam op zijn trommel,

En Chaya blaast toet-toet op haar trompet.

Ze hebben groot nieuws.

Vanavond is het groene concert, roept Chaya!

Dan spelen we voor alle dieren van het bos, zegt Oekie blij.

Oh nee... tijdens het oefenen breekt een drumstok van Charley.

Charley zucht, Wat moeten we nu doen?

Chaya legt haar trompet neer en zegt: Hoe moeten we nu een concert geven zonder drumstokken?

Gelukkig was er nog Oekie. Zij is altijd positief en heeft een goed idee. Zeg vrienden, wij zijn plantaardige eiwitten! We zijn sterk genoeg om dit op te lossen. Kom we gaan een oplossing zoeken in het bos, moedigt ze de anderen aan.

Charley en Chaya gaan met volle moed mee met Oekie. Onderweg vinden ze van alles in het bos.

Hier een tak, roept Chaya! Daar kunnen we misschien iets mee doen.

Oekie zegt blij: Goed zo Chaya, ik heb al 2 grote eikels gevonden.

Ook Charley vindt nog iets in het bos. We kunnen misschien een handvat maken met deze bladeren?

“Zo, hiermee kunnen we zeker een nieuwe drumstok maken!” besluit Oekie.

Helpen jullie mee?

Zo dat heb jij goed gedaan!

Charley heeft zijn nieuwe drumstok uitgeprobeerd en het klinkt fantastisch!

Nu gaan ze samen het boslied inoefenen.

Ook jij kan het lied hier inoefenen.

Zing met ons mee!

Wauw, nu zijn we helemaal klaar voor het concert, spannend! zegt Charley vrolijk.

Amai wat is er veel volk. Kijk daar is Dorien de duif, zegt Oekie.

Het concert was prachtig en de zwamzakken speelden nog lang muziek.

Dit allemaal omdat ze zo sterk en gezond zijn!
`;

  function splitSentences(text){
    const paras = text.split(/\n{2,}/).map(p=>p.trim()).filter(Boolean);
    const sentences = [];
    paras.forEach(p=>{
      const parts = p.match(/[^.!?\n]+[.!?]{0,1}/g) || [p];
      parts.forEach(s=>{const t=s.trim(); if(t) sentences.push(t)});
    });
    return sentences;
  }

  const sentences = splitSentences(rawText);
  const storyEl = document.getElementById('story');
  sentences.forEach((s,i)=>{
    const span = document.createElement('div');
    span.className = 'sentence';
    span.id = 's'+i;
    span.textContent = s;
    span.addEventListener('click', ()=>{goToSentence(i);});
    storyEl.appendChild(span);
  });

  let synth = window.speechSynthesis;
  let voices = [];
  let currentIndex = 0;
  let playing = false;
  let utter = null;
  const boslied = document.getElementById('boslied');

  const voiceSelect = document.getElementById('voiceSelect');
  const rateInput = document.getElementById('rate');
  const playBtn = document.getElementById('playPause');
  const stopBtn = document.getElementById('stop');

  function populateVoices(){
    voices = synth.getVoices().filter(v=>v.lang && v.name);
    voiceSelect.innerHTML = '';
    voices.forEach((v,i)=>{
      const o = document.createElement('option');
      o.value = i;
      o.textContent = v.name + ' — ' + v.lang + (v.default? ' (default)':'');
      voiceSelect.appendChild(o);
    });
    const kinderStem = voices.find(v => /nl/i.test(v.lang));
    if (kinderStem) voiceSelect.value = voices.indexOf(kinderStem);
  }
  populateVoices();
  if (speechSynthesis.onvoiceschanged !== undefined) speechSynthesis.onvoiceschanged = populateVoices;

  function highlight(i){
    document.querySelectorAll('.sentence').forEach(el=>el.classList.remove('active'));
    const el = document.getElementById('s'+i);
    if(el){ el.classList.add('active'); el.scrollIntoView({behavior:'smooth',block:'center'}); }
  }

  function cleanText(t){ return t.replace(/[“”"']/g,''); }

  async function speakFrom(idx){
    if(idx < 0) idx = 0;
    if(idx >= sentences.length){
      // einde: terug naar start
      stop();
      return;
    }
    playing = true;
    currentIndex = idx;
    highlight(currentIndex);

    const text = cleanText(sentences[currentIndex]);
    utter = new SpeechSynthesisUtterance(text);
    const v = voices[voiceSelect.value];
    if(v) utter.voice = v;
    utter.rate = parseFloat(rateInput.value);

    utter.onend = async () => {
      let delay = 600;

      // Speciale trigger: na "Zing met ons mee!"
      if (text.includes('Zing met ons mee')) {
        boslied.currentTime = 0;
        boslied.play();
        await new Promise(r => setTimeout(r, 67000)); // 1:07 seconden
        boslied.pause();

        // Wauw-zin toevoegen en inspreken
        const extra = "Wauw, nu zijn we helemaal klaar voor het concert.";
        const extraUtter = new SpeechSynthesisUtterance(extra);
        if(v) extraUtter.voice = v;
        extraUtter.rate = parseFloat(rateInput.value);
        synth.speak(extraUtter);
        await new Promise(r => extraUtter.onend = r);
      }

      setTimeout(() => {
        if(playing && currentIndex < sentences.length - 1){
          speakFrom(currentIndex + 1);
        } else {
          // klaar met alles → reset naar start
          stop();
        }
      }, delay);
    };

    synth.speak(utter);
    updatePlayButton();
  }

  function togglePlayPause(){
    if(playing){
      synth.cancel(); boslied.pause();
      playing = false;
    } else {
      speakFrom(currentIndex);
    }
    updatePlayButton();
  }

  function stop(){
    synth.cancel(); boslied.pause();
    playing = false;
    currentIndex = 0;
    highlight(currentIndex);
    updatePlayButton();
  }

  function goToSentence(i){
    synth.cancel();
    currentIndex = i;
    if(playing) speakFrom(currentIndex); else highlight(currentIndex);
  }

  function updatePlayButton(){
    playBtn.textContent = playing ? '⏸︎' : '▶︎';
  }

  playBtn.addEventListener('click', togglePlayPause);
  stopBtn.addEventListener('click', stop);
  highlight(0);
</script>
</body>
</html>


